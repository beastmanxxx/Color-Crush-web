<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mines Game - Stylish</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box; font-family: 'Orbitron', sans-serif;}
    body {
      background: radial-gradient(ellipse at bottom, #0d0d1a 0%, #000 100%);
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .stars {
      background: url('https://raw.githubusercontent.com/VincentGarreau/particles.js/master/demo/img/stars.jpg') repeat;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; opacity: 0.2;
      animation: moveStars 60s linear infinite;
    }
    @keyframes moveStars {
      from {background-position: 0 0;}
      to {background-position: -10000px 5000px;}
    }
    header, footer {text-align: center; padding: 1rem; background: rgba(0,0,0,0.4);}
    .wallet {margin-top: 10px; font-size: 1.2rem; color: #0f0;}
    .container {padding: 20px; max-width: 600px; margin: auto; text-align: center;}
    .box-grid {display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0;}
    .box {
      background: #111; border: 2px solid #444; color: #fff;
      padding: 20px; border-radius: 10px; cursor: pointer;
      transition: all 0.2s ease-in-out;
    }
    .box:hover {transform: scale(1.05); background: #222;}
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; width: 100%; background: #111;
      display: flex; justify-content: space-around; padding: 10px 0;
    }
    .bottom-nav button {
      background: none; color: #fff; border: none; font-size: 1rem; cursor: pointer;
    }
    .note {font-size: 0.85rem; margin-top: 10px; color: #aaa;}
    input, select, textarea {
      padding: 8px; margin: 8px 0; border-radius: 8px; border: none;
      width: 100%; background: #222; color: #fff;
    }
    .btn {
      background: #0f0; color: #000; padding: 10px 20px;
      border-radius: 10px; border: none; cursor: pointer;
      margin-top: 10px;
    }
    .cashout-effect {
      position: absolute; color: #0f0; font-size: 1rem;
      pointer-events: none;
    }
    .withdraw-message {
      background: #222; color: #0f0; padding: 10px; border-radius: 10px;
      margin-top: 15px; font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="stars"></div>
  <header>
    <h2>Mines Game</h2>
    <div class="wallet">Balance: â‚¹<span id="wallet">1000</span></div>
  </header>

  <div class="container" id="main">
    <label for="bet">Select Bet:</label>
    <select id="bet">
      <option value="10">â‚¹10</option>
      <option value="20">â‚¹20</option>
      <option value="50">â‚¹50</option>
      <option value="100">â‚¹100</option>
    </select>
    <button class="btn" onclick="startGame()">Start Game</button>

    <div id="game" style="display:none;">
      <div class="box-grid" id="boxes"></div>
      <button class="btn" onclick="cashout()">Cashout</button>
    </div>
    <div class="note">Click boxes to avoid the boom ðŸ’¥. Each correct box increases your reward. Cashout before hitting the boom!</div>
  </div>

  <div class="container" id="deposit" style="display:none;">
    <p>Pay to this UPI: <b>8979873681@mbk</b></p>
    <input type="number" id="depositAmount" placeholder="Enter Amount (â‚¹)">
    <a id="upiLink" href="#" class="btn" target="_blank">Deposit Now</a>
    <div class="note">After completing payment, click the button below to confirm.</div>
    <button class="btn" onclick="confirmDeposit()">I've Paid</button>
    <div class="note">Your deposit will be added to your wallet and shown in history.</div>
  </div>

  <div class="container" id="withdraw" style="display:none;">
    <form id="withdrawForm">
      <input type="text" name="UPI" placeholder="Enter your UPI ID" required>
      <input type="number" name="amount" placeholder="Amount (â‚¹)" required>
      <input type="hidden" name="_subject" value="Withdraw Request">
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_template" value="table">
      <button type="submit" class="btn">Withdraw Now</button>
    </form>
    <div class="note">Withdrawals take up to 8 hours to process.</div>
    <div id="withdrawMessage"></div>
  </div>

  <div class="container" id="history" style="display:none;">
    <div id="historyList"></div>
    <div class="note">Your game and transaction history will appear here.</div>
  </div>

  <footer>
    <p>Enjoy the game responsibly!</p>
  </footer>

  <div class="bottom-nav">
    <button onclick="showPage('deposit')">Deposit</button>
    <button onclick="showPage('main')">Mines</button>
    <button onclick="showPage('withdraw')">Withdraw</button>
    <button onclick="showPage('history'); renderHistory();">All History</button>
  </div>

  <script>
    let wallet = parseInt(localStorage.getItem("wallet") || "0");
    let bet = 0;
    let currentMultiplier = 0;
    let boomIndex = -1;
    let history = JSON.parse(localStorage.getItem("history") || "[]");

    const walletEl = document.getElementById("wallet");

    function updateWallet() {
      walletEl.textContent = wallet;
      localStorage.setItem("wallet", wallet);
    }

    function showPage(id) {
      ["main", "deposit", "withdraw", "history"].forEach(p => document.getElementById(p).style.display = "none");
      document.getElementById(id).style.display = "block";
    }

    function startGame() {
      bet = parseInt(document.getElementById("bet").value);
      if (wallet < bet) return alert("Insufficient balance!");
      wallet -= bet;
      updateWallet();
      currentMultiplier = 1;
      boomIndex = Math.floor(Math.random() * 25);
      const boxGrid = document.getElementById("boxes");
      boxGrid.innerHTML = "";
      for (let i = 0; i < 25; i++) {
        const btn = document.createElement("div");
        btn.className = "box";
        btn.textContent = i + 1;
        btn.onclick = () => openBox(i, btn);
        boxGrid.appendChild(btn);
      }
      document.getElementById("game").style.display = "block";
    }

    function openBox(i, el) {
      if (i === boomIndex) {
        el.textContent = "ðŸ’¥";
        el.style.background = "#f00";
        alert("Boom! You lost.");
        endGame();
      } else {
        const win = bet * currentMultiplier;
        el.textContent = "+â‚¹" + win;
        el.style.background = "#0f0";
        currentMultiplier++;
        el.onclick = null;
      }
    }

    function cashout() {
      const gain = bet * (currentMultiplier - 1);
      wallet += gain;
      updateWallet();
      spawnCrystalAnimation();
      alert("You cashed out â‚¹" + gain);
      endGame();
    }

    function endGame() {
      document.getElementById("game").style.display = "none";
    }

    document.getElementById("depositAmount").addEventListener("input", function () {
      const amount = this.value;
      const upi = "8979873681@mbk";
      const url = `upi://pay?pa=${upi}&pn=MinesGame&am=${amount}&cu=INR`;
      document.getElementById("upiLink").href = url;
    });

    function confirmDeposit() {
      const amt = parseInt(document.getElementById("depositAmount").value);
      if (!amt || isNaN(amt)) return alert("Enter a valid amount first!");
      wallet += amt;
      updateWallet();
      history.push({ type: "Deposit", amount: amt, time: new Date().toLocaleString() });
      localStorage.setItem("history", JSON.stringify(history));
      alert("Amount â‚¹" + amt + " added to your balance!");
    }

    document.getElementById("withdrawForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);
      const amount = parseInt(data.get("amount"));
      if (wallet < amount) return alert("Insufficient balance!");
      wallet -= amount;
      updateWallet();
      fetch("https://formspree.io/f/mqaqanbg", {
        method: "POST",
        headers: { 'Accept': 'application/json' },
        body: data
      }).then(() => {
        document.getElementById("withdrawMessage").innerHTML = '<div class="withdraw-message">Withdraw request submitted with amount. You will receive the payment in 8 hours.</div>';
        history.push({ type: "Withdraw", amount, time: new Date().toLocaleString() });
        localStorage.setItem("history", JSON.stringify(history));
        form.reset();
      });
    });

    function renderHistory() {
      const historyList = document.getElementById("historyList");
      if (!history.length) {
        historyList.innerHTML = "<p>No history to show.</p>";
        return;
      }
      historyList.innerHTML = history.map(h =>
        `<div>ðŸ”¹ <b>${h.type}</b>: â‚¹${h.amount} â€” <small>${h.time}</small></div>`
      ).join("");
    }

    function spawnCrystalAnimation() {
      const crystals = document.createElement("div");
      crystals.className = "cashout-effect";
      crystals.innerHTML = "ðŸ’ŽðŸ’¸";
      document.body.appendChild(crystals);
      gsap.fromTo(crystals, {
        x: window.innerWidth / 2,
        y: window.innerHeight / 2,
        opacity: 1,
      }, {
        x: 60, y: 20, opacity: 0, duration: 1.2, onComplete: () => crystals.remove()
      });
    }

    updateWallet();
  </script>
</body>
</html>
